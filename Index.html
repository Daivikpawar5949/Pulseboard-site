<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PulseBoard - Interactive News & Chat</title>
<!-- Google Fonts and Material Icons -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
<style>
  /* Reset and base */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #121212, #1e1e2f);
    color: #eee;
    overflow: hidden;
    user-select: none;
  }

  /* Scroll container for main app to allow scrolling in content */
  #app {
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* Shared button base */
  button {
    cursor: pointer;
    font-family: inherit;
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    font-weight: 600;
    transition: background-color 0.25s ease, transform 0.2s ease;
    background-color: #2a2a40;
    color: #eee;
  }
  button:focus-visible {
    outline: 3px solid #5adee8;
    outline-offset: 2px;
  }
  button:hover:not(:disabled) {
    background-color: #5adee8;
    color: #121212;
    transform: scale(1.05);
  }
  button:disabled {
    opacity: 0.4;
    cursor: default;
  }

  /* Icon button style */
  .icon-button {
    padding: 6px;
    border-radius: 50%;
    background-color: transparent;
    color: #aaa;
    transition: color 0.25s ease;
  }
  .icon-button:hover, .icon-button.active {
    color: #5adee8;
  }

  /* Material Icons sizing */
  .material-icons.md-18 { font-size: 18px; }
  .material-icons.md-24 { font-size: 24px; }
  .material-icons.md-36 { font-size: 36px; }
  .material-icons.md-48 { font-size: 48px; }

  /* Hide all pages by default */
  .page {
    display: none;
    height: 100%;
    overflow: hidden;
  }
  .page.active {
    display: flex;
    flex-direction: column;
  }

  /* ========== Sign-In Page ========== */
  #sign-in-page {
    justify-content: center;
    align-items: center;
    background: linear-gradient(120deg, #2a2a40, #121212);
  }
  #sign-in-container {
    background-color: #232332dd;
    padding: 48px 32px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 173, 255, 0.2);
    min-width: 320px;
    width: 100%;
    max-width: 380px;
  }
  #sign-in-container h1 {
    font-weight: 700;
    font-size: 2.5rem;
    margin-bottom: 24px;
    color: #5adee8;
    text-align: center;
    user-select: none;
  }
  #sign-in-container label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    font-size: 1rem;
    color: #aadcee;
  }
  #sign-in-container input[type="text"] {
    width: 100%;
    padding: 12px 14px;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    background-color: #1e1e2f;
    color: #eee;
    margin-bottom: 24px;
  }
  #sign-in-container input[type="text"]::placeholder {
    color: #888;
  }
  #sign-in-container button {
    width: 100%;
    font-size: 1.2rem;
    background-color: #5adee8;
    color: #121212;
    font-weight: 700;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(90, 222, 232, 0.6);
  }
  #sign-in-container button:disabled {
    background-color: #399fac;
    cursor: not-allowed;
    box-shadow: none;
  }

  /* ========== PulseBoard Main App ========== */
  #pulseboard-page {
    flex: 1 1 auto;
    display: grid;
    grid-template-columns: 280px 1fr 320px;
    grid-template-rows: auto 1fr auto;
    grid-template-areas:
      "header header header"
      "profile news chat"
      "profile news chat";
    height: 100vh;
    background: linear-gradient(135deg, #121212cc, #1e1e2fcc);
  }

  /* Header area */
  header#main-header {
    grid-area: header;
    background-color: #18182fcc;
    padding: 0 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #333344;
    box-shadow: 0 2px 8px rgba(26, 173, 255, 0.2);
    user-select: none;
  }
  header#main-header h1 {
    font-weight: 700;
    font-size: 1.75rem;
    color: #5adee8;
  }
  #signout-btn {
    background: transparent;
    color: #5adee8;
    border: 2px solid #5adee8;
    padding: 6px 18px;
    border-radius: 12px;
    font-weight: 700;
    font-size: 1rem;
    transition: background-color 0.3s ease;
  }
  #signout-btn:hover {
    background-color: #5adee8;
    color: #121212;
  }

  /* Profile sidebar */
  #profile-sidebar {
    grid-area: profile;
    background-color: #232332cc;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    overflow-y: auto;
  }
  #profile-sidebar h2 {
    font-size: 1.2rem;
    font-weight: 700;
    color: #5adee8;
    margin: 0 0 12px 0;
  }
  #profile-sidebar .pfp {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background-color: #444466;
    background-size: cover;
    background-position: center;
    margin: 0 auto 14px auto;
    border: 3px solid #5adee8;
  }
  #profile-sidebar label {
    font-weight: 600;
    font-size: 0.9rem;
    user-select: none;
    display: block;
    margin-bottom: 4px;
  }
  #profile-sidebar input[type="text"],
  #profile-sidebar input[type="number"],
  #profile-sidebar textarea {
    width: 100%;
    background-color: #1e1e2f;
    border: none;
    border-radius: 8px;
    color: #eee;
    padding: 8px 12px;
    font-size: 0.9rem;
    font-family: inherit;
    margin-bottom: 12px;
    resize: vertical;
  }
  #profile-sidebar textarea {
    min-height: 60px;
  }
  #profile-sidebar input[type="file"] {
    padding: 4px;
    margin-bottom: 14px;
    color: #eee;
  }
  #profile-sidebar button {
    background-color: #5adee8;
    color: #121212;
    font-weight: 700;
    font-size: 1rem;
    margin-top: auto;
  }

  /* News area */
  #news-section {
    grid-area: news;
    display: flex;
    flex-direction: column;
    padding: 24px;
    overflow-y: auto;
    gap: 24px;
  }
  #news-filter {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
  }
  #news-filter select {
    background-color: #1e1e2f;
    border: none;
    border-radius: 12px;
    color: #eee;
    font-size: 1rem;
    padding: 8px 16px;
    min-width: 140px;
  }

  /* News card */
  .news-card {
    background-color: #232332cc;
    border-radius: 14px;
    box-shadow: 0 4px 16px rgba(26, 173, 255, 0.1);
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 14px;
    cursor: pointer;
    transition: box-shadow 0.3s ease;
  }
  .news-card:hover, .news-card:focus-within {
    box-shadow: 0 10px 40px rgba(26, 173, 255, 0.6);
    outline: none;
  }
  .news-card h3 {
    margin: 0;
    font-weight: 700;
    font-size: 1.3rem;
    color: #aadcee;
  }
  .news-card .news-summary {
    color: #ccc;
    font-size: 1rem;
    line-height: 1.4;
    max-height: 3.6em;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .news-card .news-meta {
    display: flex;
    justify-content: flex-start;
    gap: 24px;
    font-size: 0.9rem;
    color: #888;
  }
  .news-card .news-meta span {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .material-icons.md-18 {
    vertical-align: middle;
  }

  /* News like/dislike controls */
  .news-actions {
    margin-top: auto;
    display: flex;
    justify-content: flex-end;
    gap: 24px;
  }
  .news-actions button {
    background: transparent;
    color: #aaa;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 8px;
    border-radius: 8px;
  }
  .news-actions button.active {
    color: #5adee8;
  }
  .news-actions button:hover {
    color: #5adee8;
  }

  /* News detail modal */
  #news-modal-backdrop {
    position: fixed;
    inset: 0;
    background-color: rgba(12, 12, 20, 0.85);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }
  #news-modal-backdrop.active {
    display: flex;
  }
  #news-modal {
    background-color: #232332ee;
    width: 90%;
    max-width: 700px;
    border-radius: 18px;
    padding: 24px 32px;
    box-shadow: 0 0 40px #5adee8aa;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
  }
  #news-modal h2 {
    margin-top: 0;
    color: #5adee8;
  }
  #news-modal p {
    line-height: 1.6;
    color: #ccc;
  }
  #news-modal .close-btn {
    position: absolute;
    top: 16px;
    right: 16px;
    background: transparent;
    font-size: 28px;
    color: #5adee8;
    font-weight: 700;
    cursor: pointer;
    border: none;
  }
  #news-modal .close-btn:hover {
    color: #aadcee;
  }

  /* Chat section */
  #chat-section {
    grid-area: chat;
    display: flex;
    flex-direction: column;
    background-color: #232332cc;
    padding: 16px 20px;
    border-left: 1px solid #333344;
  }
  #chat-messages {
    flex: 1 1 auto;
    overflow-y: auto;
    padding-bottom: 12px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .chat-message {
    background-color: #1e1e2f;
    padding: 12px 16px;
    border-radius: 16px;
    max-width: 75%;
    word-wrap: break-word;
    box-shadow: 0 2px 8px #0008;
  }
  .chat-message.sent {
    align-self: flex-end;
    background-color: #5adee8cc;
    color: #121212;
  }
  .chat-message .meta {
    font-size: 0.75rem;
    opacity: 0.6;
    margin-top: 4px;
  }
  #chat-input-area {
    margin-top: 12px;
    display: flex;
    gap: 12px;
  }
  #chat-input {
    flex: 1 1 auto;
    padding: 10px 14px;
    font-size: 1rem;
    border-radius: 16px;
    border: none;
    background-color: #1e1e2f;
    color: #eee;
    resize: none;
    font-family: inherit;
    min-height: 44px;
    max-height: 100px;
    overflow-y: auto;
  }
  #chat-send-btn {
    background-color: #5adee8;
    color: #121212;
    padding: 0 18px;
    font-weight: 700;
    font-size: 1.1rem;
    border-radius: 16px;
    min-width: 80px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #chat-send-btn:disabled {
    background-color: #399fac;
    cursor: not-allowed;
  }

  /* Scrollbars */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  ::-webkit-scrollbar-track {
    background: #121212;
  }
  ::-webkit-scrollbar-thumb {
    background: #5adee8cc;
    border-radius: 20px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: #5adee8ee;
  }

  /* Responsive adjustments */
  @media (max-width: 1024px) {
    #pulseboard-page {
      grid-template-columns: 1fr 1fr;
      grid-template-areas:
        "header header"
        "news chat"
        "profile chat";
    }
    #profile-sidebar {
      order: 3;
      height: 240px;
      overflow-y: auto;
    }
    #chat-section {
      order: 2;
      grid-area: chat;
      border-left: none;
      border-top: 1px solid #333344;
    }
  }
  @media (max-width: 640px) {
    #pulseboard-page {
      grid-template-columns: 1fr;
      grid-template-rows: auto 1fr 300px 60px;
      grid-template-areas:
        "header"
        "news"
        "chat"
        "profile";
    }
    #profile-sidebar {
      order: 4;
      height: 220px;
      overflow-y: auto;
      border-top: 1px solid #333344;
    }
    #chat-section {
      order: 3;
      height: 300px;
      border-left: none;
      border-top: 1px solid #333344;
    }
  }

</style>
</head>
<body>
  <div id="app" role="main">

    <!-- SIGN-IN PAGE -->
    <section id="sign-in-page" class="page active" aria-label="Sign in page">
      <div id="sign-in-container" role="form" aria-labelledby="sign-in-title">
        <h1 id="sign-in-title">Welcome to PulseBoard</h1>
        <label for="signin-username">Enter your username</label>
        <input type="text" id="signin-username" name="signin-username" placeholder="Your username" aria-required="true" autocomplete="username" />
        <button id="signin-btn" type="button" disabled>Sign In</button>
      </div>
    </section>

    <!-- MAIN PULSEBOARD PAGE -->
    <section id="pulseboard-page" class="page" aria-label="PulseBoard main application">

      <header id="main-header" role="banner">
        <h1>PulseBoard</h1>
        <button id="signout-btn" title="Sign Out" aria-label="Sign out">Sign Out</button>
      </header>

      <aside id="profile-sidebar" role="complementary" aria-label="User profile editing area">
        <h2>My Profile</h2>
        <div class="pfp" id="profile-pfp" aria-label="Profile picture" tabindex="0"></div>
        <label for="pfp-upload">Change Profile Picture</label>
        <input type="file" id="pfp-upload" accept="image/*" aria-describedby="pfp-upload-desc"/>
        <div id="pfp-upload-desc" class="sr-only">Select an image file to update your profile picture</div>

        <label for="profile-name">Name</label>
        <input type="text" id="profile-name" name="profile-name" aria-describedby="profile-name-desc" />
        <div id="profile-name-desc" class="sr-only">Enter your full name</div>

        <label for="profile-age">Age</label>
        <input type="number" id="profile-age" name="profile-age" min="0" max="150" aria-describedby="profile-age-desc" />
        <div id="profile-age-desc" class="sr-only">Enter your age</div>

        <label for="profile-about">About</label>
        <textarea id="profile-about" name="profile-about" rows="3" aria-describedby="profile-about-desc"></textarea>
        <div id="profile-about-desc" class="sr-only">Write a few lines about yourself</div>

        <label for="profile-interests">Interests (comma-separated)</label>
        <input type="text" id="profile-interests" aria-describedby="profile-interests-desc" />
        <div id="profile-interests-desc" class="sr-only">Enter your interests separated by commas</div>

        <label for="profile-skills">Skills (comma-separated)</label>
        <input type="text" id="profile-skills" aria-describedby="profile-skills-desc" />
        <div id="profile-skills-desc" class="sr-only">Enter your skills separated by commas</div>

        <button id="save-profile-btn" type="button" aria-live="polite">Save Profile</button>
      </aside>

      <main id="news-section" role="main" aria-label="News feed and filters">
        <div id="news-filter" role="search">
          <label for="filter-category" class="sr-only">Filter news by category</label>
          <select id="filter-category" aria-label="Filter news by category">
            <option value="all" selected>All categories</option>
          </select>
        </div>
        <div id="news-list" tabindex="0" aria-live="polite" aria-relevant="additions" aria-atomic="false" role="list">
          <!-- news cards dynamically injected here -->
        </div>
      </main>

      <aside id="chat-section" role="complementary" aria-label="Chat box for sharing news and discussions">
        <div id="chat-messages" role="log" aria-live="polite" aria-relevant="additions" tabindex="0">
          <!-- chat messages -->
        </div>
        <div id="chat-input-area">
          <textarea id="chat-input" aria-label="Type your message" placeholder="Type your message here..." rows="1"></textarea>
          <button id="chat-send-btn" disabled aria-label="Send message">
            <span class="material-icons md-24">send</span>
          </button>
        </div>
      </aside>

    </section>

    <!-- NEWS MODAL -->
    <div id="news-modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="news-modal-title" tabindex="-1">
      <div id="news-modal">
        <button class="close-btn" aria-label="Close news details">&times;</button>
        <h2 id="news-modal-title"></h2>
        <p id="news-modal-content"></p>
      </div>
    </div>

  </div>

  <!-- Screen reader only class -->
  <style>
    .sr-only {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0,0,0,0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }
  </style>

<script>
(() => {
  // Util: debounce
  function debounce(func, wait) {
    let timeout;
    return function(...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(this, args), wait);
    };
  }

  // Data keys for localStorage
  const STORAGE_KEYS = {
    USERS: 'pulseboard_users',
    CURRENT_USER: 'pulseboard_current_user',
    NEWS_LIKES: 'pulseboard_news_likes',
    CHAT_MESSAGES: 'pulseboard_chat_messages'
  };

  // Elements
  const signInPage = document.getElementById('sign-in-page');
  const pulseBoardPage = document.getElementById('pulseboard-page');

  const signinUsernameInput = document.getElementById('signin-username');
  const signinBtn = document.getElementById('signin-btn');

  const signoutBtn = document.getElementById('signout-btn');

  // Profile elements
  const profilePfp = document.getElementById('profile-pfp');
  const pfpUploadInput = document.getElementById('pfp-upload');
  const profileNameInput = document.getElementById('profile-name');
  const profileAgeInput = document.getElementById('profile-age');
  const profileAboutInput = document.getElementById('profile-about');
  const profileInterestsInput = document.getElementById('profile-interests');
  const profileSkillsInput = document.getElementById('profile-skills');
  const saveProfileBtn = document.getElementById('save-profile-btn');

  // News elements
  const newsListEl = document.getElementById('news-list');
  const filterCategorySelect = document.getElementById('filter-category');

  // News modal
  const newsModalBackdrop = document.getElementById('news-modal-backdrop');
  const newsModal = document.getElementById('news-modal');
  const newsModalTitle = document.getElementById('news-modal-title');
  const newsModalContent = document.getElementById('news-modal-content');
  const newsModalCloseBtn = newsModal.querySelector('.close-btn');

  // Chat elements
  const chatMessagesEl = document.getElementById('chat-messages');
  const chatInput = document.getElementById('chat-input');
  const chatSendBtn = document.getElementById('chat-send-btn');

  // State
  let currentUser = null;
  let users = {}; // username key -> profile data
  let newsLikes = {}; // {newsId: {likes: Set(usernames), dislikes: Set(usernames)}}
  let chatMessages = []; // Array of {id, sender, message, timestamp}

  // Demo data for news
  const DEMO_NEWS = [
    {
      id: 'news1',
      title: 'Breakthrough in Quantum Computing',
      category: 'Technology',
      summary: 'Scientists achieve new milestone in quantum computing, promising faster and more efficient processors.',
      content: 'In a groundbreaking advancement, researchers have developed a quantum computer prototype that can solve complex problems exponentially faster than classical computers. This could revolutionize fields like cryptography, materials science, and more.',
      publishDate: '2024-06-22'
    },
    {
      id: 'news2',
      title: 'Global Climate Summit 2024',
      category: 'Environment',
      summary: 'World leaders convene to discuss ambitious plans for reducing global carbon emissions by 2030.',
      content: 'The 2024 Global Climate Summit resulted in commitments from over 100 countries to accelerate clean energy adoption, deforestation prevention, and climate adaptation investments.',
      publishDate: '2024-06-21'
    },
    {
      id: 'news3',
      title: 'New AI Language Model Released',
      category: 'Artificial Intelligence',
      summary: 'Top tech company launches a new large language model designed for higher accuracy and ethical use.',
      content: 'The model incorporates advanced safety features and can generate natural language output more efficiently, helping businesses automate customer service and content creation tasks responsibly.',
      publishDate: '2024-06-18'
    },
    {
      id: 'news4',
      title: 'Mars Rover Discovers Signs of Ancient Life'